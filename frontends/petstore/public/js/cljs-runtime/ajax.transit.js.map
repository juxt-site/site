{"version":3,"sources":["ajax/transit.cljc"],"mappings":";AAMA,4BAAA,oCAAAA,hEAAMI;AAAN,AAAA,IAAAH,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;WAAA,AAAAE,4CAAAF,eAAA,lEAA4BI;AAA5B,AACE,IAAAC,mBAAID;AAAJ,AAAA,oBAAAC;AAAAA;;AAAA;;;AAEQ,gCAAA,hCAAMC,wEACHF,KAAKG;AADR,AAEE,IAAMC,SAAO,iBAAAH,mBAAI,AAAA,uFAASE;AAAb,AAAA,oBAAAF;AAAAA;;AACI,OAACI,uDAASL,KAAKG;;;AADhC,AAEE,sEAA0BG;AAA1B,AACE,OAACC,wBAAQH,OAAOE;;;AAOhC,AAAA;;;;;;;;;sCAAA,8CAAAE,pFAAME;AAAN,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC;;;KAAA;AAAA,OAAAA,kEAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAC,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,oEAAA,pEAAMD;AAAN,AAQM,yEAAA,lEAACE;;;AARP,CAAA,oEAAA,pEAAMF,+EASFP;AATJ,AAUK,IAAMH,OAAK,AAACD,0BAAaI;IACnBU,YAAU,4OAAA,OAAA,jPAAI,EAAI,kDAAA,lDAACC,6CAAEd,gEACH,kDAAA,lDAACc,6CAAEd;AAF3B,AAAA,kDAAA,iGAAA,zCAGU,AAACE,8BAAiBF,KAAKG,2EAChB,CAAA,uBAA4BU;;;AAdlD,CAAA,8DAAA,9DAAMH;;AAAN,AAgBU,+BAAA,/BAAMK,sEAAiBZ;AAAvB,AACE,IAAMa,SAAO,iBAAAf,mBAAI,AAAA,sFAASE;AAAb,AAAA,oBAAAF;AAAAA;;AACI,8DAAA,vDAACgB,4GAAed;;;AADjC,AAEE,sEAA2Be;AAA3B,AACE,OAACC,uBAAOH,OAAO,AAACI,qBAASF;;;AAUzC,AAAA;;;;;;;uCAAA,+CAAAV,tFAAMc;AAAN,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC;;;KAAA;AAAA,OAAAA,mEAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,mEAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAX,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,qEAAA,rEAAMW;AAAN,AAMM,0EAAA,nEAACC;;;AANP,CAAA,qEAAA,rEAAMD,gFAOFnB;AAPJ,AAQK,OAACoB,mEAAwB,AAACxB,0BAAaI,MAAMA;;;AARlD,CAAA,qEAAA,rEAAMmB,gFASFtB,KAAKG;AATT,AAUK,gDAAA,2CAAA,wFAAA,oEAAA,UAAA,qEAAA,mFAAA,lZAACqB,yIACO,AAACT,6BAAgBZ;;;AAX9B,CAAA,+DAAA,/DAAMmB;;AAAN","names":["p__22451","map__22452","cljs.core/--destructure-map","cljs.core.get","ajax.transit/transit-type","type","or__5045__auto__","ajax.transit/transit-write-fn","opts","writer","cognitect.transit.writer","params","cognitect.transit/write","var_args","G__22476","ajax.transit/transit-request-format","js/Error","ajax.transit.transit_request_format","mime-type","cljs.core._EQ_","ajax.transit/transit-read-fn","reader","cognitect.transit.reader","response","cognitect.transit/read","ajax.protocols/-body","G__22491","ajax.transit/transit-response-format","ajax.transit.transit_response_format","ajax.interceptors/map->ResponseFormat"],"sourcesContent":["(ns ajax.transit\n    (:require [cognitect.transit :as t]\n              [ajax.interceptors :as i]\n              [ajax.protocols :as pr]\n              [ajax.util :as u]))\n\n(defn transit-type [{:keys [type]}]\n  (or type #? (:cljs :json :clj :msgpack)))\n\n#? (:cljs (defn transit-write-fn\n            [type opts]\n            (let [writer (or (:writer opts)\n                             (t/writer type opts))]\n              (fn transit-write-params [params]\n                (t/write writer params))))\n    :clj (defn transit-write-fn\n           [type opts]\n           (fn transit-write-params [stream params]\n             (let [writer (t/writer stream type opts)]\n               (t/write writer params)))))\n\n(defn transit-request-format\n  \"Returns a Transit request format.\n\n   Options include:\n   :writer Explicit Transit writer. If not supplied one will be created using the other options.\n           The default type is :json for ClojureScript and :msgpack for Clojure.\n   :type Override the default transit type with value :json, :json-verbose or :msgpack\n   :handlers Custom Transit handlers (refer to Transit documentation)\"\n  ([] (transit-request-format {}))\n  ([opts]\n     (let [type (transit-type opts)\n           mime-type (if (or (= type :json)\n                             (= type :json-verbose)) \"json\" \"msgpack\")]\n       {:write (transit-write-fn type opts)\n        :content-type (str \"application/transit+\" mime-type)})))\n\n#? (:cljs (defn transit-read-fn [opts]\n            (let [reader (or (:reader opts)\n                             (t/reader :json opts))]\n              (fn transit-read-response [response]\n                (t/read reader (pr/-body response)))))\n    :clj (defn transit-read-fn [request]\n           (fn transit-read-response [response]\n             (let [content-type (u/get-content-type response)\n                   type         (if (.contains content-type \"msgpack\")\n                                  :msgpack :json)\n                   stream       (pr/-body response)\n                   reader       (t/reader stream type request)]\n               (t/read reader)))))\n\n(defn transit-response-format\n  \"Returns a Transit response format.\n\n   Options include:\n   :reader (CLJS only) Explicit Transit reader. If not supplied one will be created using the other options.\n   :handlers Custom Transit handlers (refer to Transit documentation)\"\n  ([] (transit-response-format {}))\n  ([opts]\n     (transit-response-format (transit-type opts) opts))\n  ([type opts]\n     (i/map->ResponseFormat\n      {:read (transit-read-fn opts)\n       :description \"Transit\"\n       :content-type\n       #? (:cljs [\"application/transit+json\"]\n           :clj [\"application/transit+msgpack\"\n                 \"application/transit+json\"])})))\n"]}